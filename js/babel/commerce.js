'use strict';

(function () {

  // format card form inputs
  $('.cc-num-input').payment('formatCardNumber');
  $('.cc-exp-input').payment('formatCardExpiry');
  $('.cc-cvc-input').payment('formatCardCVC');

  //
  // general helpers:
  //

  // add error css class
  function addErr(input) {
    $(input).removeClass('input-success');
    $(input).addClass('input-error');
  }

  // add success css class
  function addOk(input) {
    $(input).removeClass('input-error');
    $(input).addClass('input-success');
  }

  // show input error icon
  function showInputErrIcon(input, iconSuc, iconErr) {
    if ($(input).hasClass('input-error')) {
      $(iconSuc).addClass('hidden');
      $(iconErr).removeClass('hidden');
    }
  }

  // show input success icon
  function showInputOkIcon(input, iconSuc, iconErr) {
    if ($(input).hasClass('input-success')) {
      $(iconSuc).removeClass('hidden');
      $(iconErr).addClass('hidden');
    }
  }

  // reset input icons
  function resetInput(input, iconSuc, iconErr) {
    $(input).removeClass('input-error');
    $(iconSuc).addClass('hidden');
    $(iconErr).addClass('hidden');
    $(input).removeClass('input-success');
  }

  //
  // check stuff
  //

  // check CARD NUMBER
  (function checkCardNum() {

    // card number css classes setting
    var cardNum = {
      input: '.cc-num-input',
      type: '.cc-type',
      iconOk: '.cc-num-icon-success',
      iconErr: '.cc-num-icon-error'
    };

    // highlight selected card type (brand)
    function markCardType(name) {
      if ($(cardNum.input).hasClass(name)) {
        $(cardNum.type + '.' + name).addClass('blue');
      }
    }

    // reset card type highlight
    function resetCardType() {
      $(cardNum.type).removeClass('blue');
    }

    // validate card number input
    function validCardNum() {

      // get card number
      var cardValue = $(cardNum.input).val();

      // validate card number
      var cardValid = $.payment.validateCardNumber(cardValue);

      // add proper indicators to valid/invalid number
      if (cardValid === true) {
        addOk(cardNum.input);
        showInputOkIcon(cardNum.input, cardNum.iconOk, cardNum.iconErr);
      }
      if (cardValid === false) {
        addErr(cardNum.input);
        showInputErrIcon(cardNum.input, cardNum.iconOk, cardNum.iconErr);
      }
    }

    // listen to card number input
    $(cardNum.input).on('input', function () {

      // when input is long enough...
      if ($(this).val().length > 1) {

        // highlight proper card type name
        markCardType('visa');
        markCardType('mastercard');
        markCardType('amex');
        markCardType('discover');

        // validate number according to statements
        if ($(this).hasClass('amex') && $(this).val().length > 16) {

          validCardNum();
        }

        if ($(this).hasClass('identified') && $(this).val().length > 17) {

          validCardNum();
        }

        // reset input indicators according to statements
        if ($(this).hasClass('amex') && $(this).val().length < 17) {

          resetInput(this, cardNum.iconOk, cardNum.iconErr);
        }

        if ($(this).hasClass('amex') === false && $(this).val().length < 19) {

          resetInput(this, cardNum.iconOk, cardNum.iconErr);
        }

        // show error if unknown
        if ($(this).hasClass('unknown')) {
          addErr(this);
          showInputErrIcon(this, cardNum.iconOk, cardNum.iconErr);
        }
      } else {
        resetInput(this, cardNum.iconOk, cardNum.iconErr);
        resetCardType();
      }
    });
  })();

  (function checkExpDate() {

    // card expiry number css classes setting
    var cardExp = {
      input: '.cc-exp-input',
      iconOk: '.cc-exp-icon-success',
      iconErr: '.cc-exp-icon-error'
    };

    // validate number
    function validExp() {

      var expDate = $(cardExp.input).payment('cardExpiryVal');
      var expValidation = $.payment.validateCardExpiry(expDate.month, expDate.year);

      // add proper indicators to valid/invalid number
      if (expValidation === true) {
        addOk(cardExp.input);
        showInputOkIcon(cardExp.input, cardExp.iconOk, cardExp.iconErr);
      }
      if (expValidation === false) {
        addErr(cardExp.input);
        showInputErrIcon(cardExp.input, cardExp.iconOk, cardExp.iconErr);
      }
    }

    // listen to input
    $(cardExp.input).on('input', function () {

      // validate number when it's long enough
      if ($(this).val().length > 6) {
        validExp();
      }

      // otherwise, reset indicators
      else {
          resetInput(this, cardExp.iconOk, cardExp.iconErr);
        }
    });
  })();

  (function cvcCheck() {

    var cardCVC = {
      input: '.cc-cvc-input',
      iconOk: '.cc-cvc-icon-success',
      iconErr: '.cc-cvc-icon-error'
    };

    // validate number
    function cvcCheck(input) {
      var cvcNum = $(cardCVC.input).val();
      var cvcValid = $.payment.validateCardCVC(cvcNum);

      // add proper indicators to valid/invalid number
      if (cvcValid === true) {
        addOk(cardCVC.input);
        showInputOkIcon(cardCVC.input, cardCVC.iconOk, cardCVC.iconErr);
      }
      if (cvcValid === false) {
        addErr(cardCVC.input);
        showInputErrIcon(cardCVC.input, cardCVC.iconOk, cardCVC.iconErr);
      }
    }

    // listen to input
    $(cardCVC.input).on('input', function () {

      // validate number when it's long enough
      if ($(this).val().length > 2) {
        cvcCheck(this);
      }

      // otherwise, reset indicators
      else {
          resetInput(this, cardCVC.iconOk, cardCVC.iconErr);
        }
    });
  })();
})();
//# sourceMappingURL=data:application/json;base64,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QUksRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNuRDtLQUNGLENBQUMsQ0FBQztHQUVKLENBQUEsRUFBRSxDQUFFO0NBRUosQ0FBQSxFQUFFLENBQUUiLCJmaWxlIjoiY29tbWVyY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG5cbi8vIGZvcm1hdCBjYXJkIGZvcm0gaW5wdXRzXG4kKCcuY2MtbnVtLWlucHV0JykucGF5bWVudCgnZm9ybWF0Q2FyZE51bWJlcicpO1xuJCgnLmNjLWV4cC1pbnB1dCcpLnBheW1lbnQoJ2Zvcm1hdENhcmRFeHBpcnknKTtcbiQoJy5jYy1jdmMtaW5wdXQnKS5wYXltZW50KCdmb3JtYXRDYXJkQ1ZDJyk7XG5cbi8vXG4vLyBnZW5lcmFsIGhlbHBlcnM6XG4vL1xuXG4vLyBhZGQgZXJyb3IgY3NzIGNsYXNzIFxuZnVuY3Rpb24gYWRkRXJyKGlucHV0KSB7XG4gICQoaW5wdXQpLnJlbW92ZUNsYXNzKCdpbnB1dC1zdWNjZXNzJyk7XG4gICQoaW5wdXQpLmFkZENsYXNzKCdpbnB1dC1lcnJvcicpO1xufVxuXG4vLyBhZGQgc3VjY2VzcyBjc3MgY2xhc3NcbmZ1bmN0aW9uIGFkZE9rKGlucHV0KSB7XG4gICQoaW5wdXQpLnJlbW92ZUNsYXNzKCdpbnB1dC1lcnJvcicpO1xuICAkKGlucHV0KS5hZGRDbGFzcygnaW5wdXQtc3VjY2VzcycpO1xufVxuXG4vLyBzaG93IGlucHV0IGVycm9yIGljb25cbmZ1bmN0aW9uIHNob3dJbnB1dEVyckljb24oaW5wdXQsIGljb25TdWMsIGljb25FcnIpIHtcbiAgaWYgKCAkKGlucHV0KS5oYXNDbGFzcygnaW5wdXQtZXJyb3InKSApIHtcbiAgICAkKGljb25TdWMpLmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgICAkKGljb25FcnIpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgfVxufVxuXG4vLyBzaG93IGlucHV0IHN1Y2Nlc3MgaWNvblxuZnVuY3Rpb24gc2hvd0lucHV0T2tJY29uKGlucHV0LCBpY29uU3VjLCBpY29uRXJyKSB7XG4gIGlmICggJChpbnB1dCkuaGFzQ2xhc3MoJ2lucHV0LXN1Y2Nlc3MnKSApIHtcbiAgICAkKGljb25TdWMpLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAkKGljb25FcnIpLmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgfVxufVxuXG4vLyByZXNldCBpbnB1dCBpY29uc1xuZnVuY3Rpb24gcmVzZXRJbnB1dChpbnB1dCwgaWNvblN1YywgaWNvbkVycikge1xuICAkKGlucHV0KS5yZW1vdmVDbGFzcygnaW5wdXQtZXJyb3InKTtcbiAgJChpY29uU3VjKS5hZGRDbGFzcygnaGlkZGVuJyk7XG4gICQoaWNvbkVycikuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAkKGlucHV0KS5yZW1vdmVDbGFzcygnaW5wdXQtc3VjY2VzcycpO1xufVxuXG5cbi8vXG4vLyBjaGVjayBzdHVmZlxuLy9cblxuLy8gY2hlY2sgQ0FSRCBOVU1CRVIgXG4oZnVuY3Rpb24gY2hlY2tDYXJkTnVtKCkgeyBcblxuICAvLyBjYXJkIG51bWJlciBjc3MgY2xhc3NlcyBzZXR0aW5nXG4gIGNvbnN0IGNhcmROdW0gPSB7XG4gICAgaW5wdXQ6ICcuY2MtbnVtLWlucHV0JyxcbiAgICB0eXBlOiAgJy5jYy10eXBlJyxcbiAgICBpY29uT2s6ICcuY2MtbnVtLWljb24tc3VjY2VzcycsXG4gICAgaWNvbkVycjogJy5jYy1udW0taWNvbi1lcnJvcidcbiAgfTtcblxuICAvLyBoaWdobGlnaHQgc2VsZWN0ZWQgY2FyZCB0eXBlIChicmFuZClcbiAgZnVuY3Rpb24gbWFya0NhcmRUeXBlKG5hbWUpIHtcbiAgICBpZiAoICQoY2FyZE51bS5pbnB1dCkuaGFzQ2xhc3MobmFtZSkgKSB7XG4gICAgICAkKGNhcmROdW0udHlwZSArICcuJyArIG5hbWUpLmFkZENsYXNzKCdibHVlJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gcmVzZXQgY2FyZCB0eXBlIGhpZ2hsaWdodFxuICBmdW5jdGlvbiByZXNldENhcmRUeXBlKCkge1xuICAgICQoY2FyZE51bS50eXBlKS5yZW1vdmVDbGFzcygnYmx1ZScpO1xuICB9XG5cbiAgLy8gdmFsaWRhdGUgY2FyZCBudW1iZXIgaW5wdXRcbiAgZnVuY3Rpb24gdmFsaWRDYXJkTnVtKCkge1xuICAgIFxuICAgIC8vIGdldCBjYXJkIG51bWJlclxuICAgIGNvbnN0IGNhcmRWYWx1ZSA9ICQoY2FyZE51bS5pbnB1dCkudmFsKCk7XG5cbiAgICAvLyB2YWxpZGF0ZSBjYXJkIG51bWJlclxuICAgIGNvbnN0IGNhcmRWYWxpZCA9ICQucGF5bWVudC52YWxpZGF0ZUNhcmROdW1iZXIoY2FyZFZhbHVlKTtcblxuICAgIC8vIGFkZCBwcm9wZXIgaW5kaWNhdG9ycyB0byB2YWxpZC9pbnZhbGlkIG51bWJlclxuICAgIGlmICggY2FyZFZhbGlkID09PSB0cnVlICkge1xuICAgICAgYWRkT2soY2FyZE51bS5pbnB1dCk7IFxuICAgICAgc2hvd0lucHV0T2tJY29uKGNhcmROdW0uaW5wdXQsIGNhcmROdW0uaWNvbk9rLCBjYXJkTnVtLmljb25FcnIpO1xuICAgIH1cbiAgICBpZiAoIGNhcmRWYWxpZCA9PT0gZmFsc2UgKSB7XG4gICAgICBhZGRFcnIoY2FyZE51bS5pbnB1dCk7IFxuICAgICAgc2hvd0lucHV0RXJySWNvbihjYXJkTnVtLmlucHV0LCBjYXJkTnVtLmljb25PaywgY2FyZE51bS5pY29uRXJyKTtcbiAgICB9XG4gIH1cblxuICAvLyBsaXN0ZW4gdG8gY2FyZCBudW1iZXIgaW5wdXRcbiAgJChjYXJkTnVtLmlucHV0KS5vbignaW5wdXQnLCBmdW5jdGlvbigpIHtcblxuICAgIC8vIHdoZW4gaW5wdXQgaXMgbG9uZyBlbm91Z2guLi5cbiAgICBpZiAoICQodGhpcykudmFsKCkubGVuZ3RoID4gMSApIHtcbiAgICAgIFxuICAgICAgLy8gaGlnaGxpZ2h0IHByb3BlciBjYXJkIHR5cGUgbmFtZVxuICAgICAgbWFya0NhcmRUeXBlKCd2aXNhJyk7XG4gICAgICBtYXJrQ2FyZFR5cGUoJ21hc3RlcmNhcmQnKTtcbiAgICAgIG1hcmtDYXJkVHlwZSgnYW1leCcpO1xuICAgICAgbWFya0NhcmRUeXBlKCdkaXNjb3ZlcicpO1xuICAgICAgXG4gICAgICAvLyB2YWxpZGF0ZSBudW1iZXIgYWNjb3JkaW5nIHRvIHN0YXRlbWVudHNcbiAgICAgIGlmICggJCh0aGlzKS5oYXNDbGFzcygnYW1leCcpICAmJlxuICAgICAgICAkKHRoaXMpLnZhbCgpLmxlbmd0aCA+IDE2ICkge1xuICAgICAgICBcbiAgICAgICAgdmFsaWRDYXJkTnVtKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICggJCh0aGlzKS5oYXNDbGFzcygnaWRlbnRpZmllZCcpICYmXG4gICAgICAgICQodGhpcykudmFsKCkubGVuZ3RoID4gMTcgKSB7XG4gICAgICAgIFxuICAgICAgICB2YWxpZENhcmROdW0oKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gcmVzZXQgaW5wdXQgaW5kaWNhdG9ycyBhY2NvcmRpbmcgdG8gc3RhdGVtZW50c1xuICAgICAgaWYgKCAkKHRoaXMpLmhhc0NsYXNzKCdhbWV4JykgJiZcbiAgICAgICAgJCh0aGlzKS52YWwoKS5sZW5ndGggPCAxNyApIHtcbiAgICAgICAgXG4gICAgICAgIHJlc2V0SW5wdXQodGhpcywgY2FyZE51bS5pY29uT2ssIGNhcmROdW0uaWNvbkVycik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICggJCh0aGlzKS5oYXNDbGFzcygnYW1leCcpID09PSBmYWxzZSAmJlxuICAgICAgICAgICQodGhpcykudmFsKCkubGVuZ3RoIDwgMTkgKSB7XG4gICAgICAgIFxuICAgICAgICByZXNldElucHV0KHRoaXMsIGNhcmROdW0uaWNvbk9rLCBjYXJkTnVtLmljb25FcnIpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBzaG93IGVycm9yIGlmIHVua25vd25cbiAgICAgIGlmICggJCh0aGlzKS5oYXNDbGFzcygndW5rbm93bicpICkge1xuICAgICAgICBhZGRFcnIodGhpcyk7XG4gICAgICAgIHNob3dJbnB1dEVyckljb24odGhpcywgY2FyZE51bS5pY29uT2ssIGNhcmROdW0uaWNvbkVycik7XG4gICAgICB9XG5cbiAgICB9XG4gICAgXG4gICAgZWxzZSB7XG4gICAgcmVzZXRJbnB1dCh0aGlzLCBjYXJkTnVtLmljb25PaywgY2FyZE51bS5pY29uRXJyKTtcbiAgICByZXNldENhcmRUeXBlKCk7IFxuICAgIH1cblxuICB9KTtcblxufSgpKTtcblxuXG4oZnVuY3Rpb24gY2hlY2tFeHBEYXRlKCkge1xuXG4gIC8vIGNhcmQgZXhwaXJ5IG51bWJlciBjc3MgY2xhc3NlcyBzZXR0aW5nXG4gIGNvbnN0IGNhcmRFeHAgPSB7XG4gICAgaW5wdXQ6ICcuY2MtZXhwLWlucHV0JyxcbiAgICBpY29uT2s6ICcuY2MtZXhwLWljb24tc3VjY2VzcycsXG4gICAgaWNvbkVycjogJy5jYy1leHAtaWNvbi1lcnJvcidcbiAgfTtcblxuICAvLyB2YWxpZGF0ZSBudW1iZXJcbiAgZnVuY3Rpb24gdmFsaWRFeHAoKSB7XG4gICAgXG4gICAgY29uc3QgZXhwRGF0ZT0gJChjYXJkRXhwLmlucHV0KS5wYXltZW50KCdjYXJkRXhwaXJ5VmFsJyk7XG4gICAgY29uc3QgZXhwVmFsaWRhdGlvbiA9ICQucGF5bWVudC52YWxpZGF0ZUNhcmRFeHBpcnkoZXhwRGF0ZS5tb250aCwgZXhwRGF0ZS55ZWFyKTtcbiAgICBcbiAgICAvLyBhZGQgcHJvcGVyIGluZGljYXRvcnMgdG8gdmFsaWQvaW52YWxpZCBudW1iZXJcbiAgICBpZiAoZXhwVmFsaWRhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgYWRkT2soY2FyZEV4cC5pbnB1dCk7IFxuICAgICAgc2hvd0lucHV0T2tJY29uKGNhcmRFeHAuaW5wdXQsIGNhcmRFeHAuaWNvbk9rLCBjYXJkRXhwLmljb25FcnIpO1xuICAgIH1cbiAgICBpZiAoZXhwVmFsaWRhdGlvbiA9PT0gZmFsc2UpIHtcbiAgICAgIGFkZEVycihjYXJkRXhwLmlucHV0KTsgXG4gICAgICBzaG93SW5wdXRFcnJJY29uKGNhcmRFeHAuaW5wdXQsIGNhcmRFeHAuaWNvbk9rLCBjYXJkRXhwLmljb25FcnIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGxpc3RlbiB0byBpbnB1dFxuICAkKGNhcmRFeHAuaW5wdXQpLm9uKCdpbnB1dCcsIGZ1bmN0aW9uKCkge1xuXG4gICAgLy8gdmFsaWRhdGUgbnVtYmVyIHdoZW4gaXQncyBsb25nIGVub3VnaFxuICAgIGlmICggJCh0aGlzKS52YWwoKS5sZW5ndGggPiA2ICkge1xuICAgICAgdmFsaWRFeHAoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gb3RoZXJ3aXNlLCByZXNldCBpbmRpY2F0b3JzXG4gICAgZWxzZSB7XG4gICAgICByZXNldElucHV0KHRoaXMsIGNhcmRFeHAuaWNvbk9rLCBjYXJkRXhwLmljb25FcnIpO1xuICAgIH1cbiAgfSk7XG5cbn0oKSk7XG5cblxuKGZ1bmN0aW9uIGN2Y0NoZWNrKCkge1xuXG4gIGNvbnN0IGNhcmRDVkMgPSB7XG4gICAgaW5wdXQ6ICcuY2MtY3ZjLWlucHV0JyxcbiAgICBpY29uT2s6ICcuY2MtY3ZjLWljb24tc3VjY2VzcycsXG4gICAgaWNvbkVycjogJy5jYy1jdmMtaWNvbi1lcnJvcidcbiAgfTtcbiAgXG4gIC8vIHZhbGlkYXRlIG51bWJlclxuICBmdW5jdGlvbiBjdmNDaGVjayhpbnB1dCkge1xuICAgIGNvbnN0IGN2Y051bT0gJChjYXJkQ1ZDLmlucHV0KS52YWwoKTtcbiAgICBjb25zdCBjdmNWYWxpZCA9ICQucGF5bWVudC52YWxpZGF0ZUNhcmRDVkMoY3ZjTnVtKTtcbiAgICBcbiAgICAvLyBhZGQgcHJvcGVyIGluZGljYXRvcnMgdG8gdmFsaWQvaW52YWxpZCBudW1iZXJcbiAgICBpZiAoY3ZjVmFsaWQgPT09IHRydWUpIHtcbiAgICAgIGFkZE9rKGNhcmRDVkMuaW5wdXQpOyBcbiAgICAgIHNob3dJbnB1dE9rSWNvbihjYXJkQ1ZDLmlucHV0LCBjYXJkQ1ZDLmljb25PaywgY2FyZENWQy5pY29uRXJyKTtcbiAgICB9XG4gICAgaWYgKGN2Y1ZhbGlkID09PSBmYWxzZSkge1xuICAgICAgYWRkRXJyKGNhcmRDVkMuaW5wdXQpOyBcbiAgICAgIHNob3dJbnB1dEVyckljb24oY2FyZENWQy5pbnB1dCwgY2FyZENWQy5pY29uT2ssIGNhcmRDVkMuaWNvbkVycik7XG4gICAgfVxuICB9XG5cbiAgLy8gbGlzdGVuIHRvIGlucHV0XG4gICQoY2FyZENWQy5pbnB1dCkub24oJ2lucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgXG4gICAgLy8gdmFsaWRhdGUgbnVtYmVyIHdoZW4gaXQncyBsb25nIGVub3VnaFxuICAgIGlmICggJCh0aGlzKS52YWwoKS5sZW5ndGggPiAyICkge1xuICAgICAgY3ZjQ2hlY2sodGhpcyk7XG4gICAgfVxuICAgIFxuICAgIC8vIG90aGVyd2lzZSwgcmVzZXQgaW5kaWNhdG9yc1xuICAgIGVsc2Uge1xuICAgICAgcmVzZXRJbnB1dCh0aGlzLCBjYXJkQ1ZDLmljb25PaywgY2FyZENWQy5pY29uRXJyKTtcbiAgICB9XG4gIH0pO1xuXG59KCkpO1xuXG59KCkpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
